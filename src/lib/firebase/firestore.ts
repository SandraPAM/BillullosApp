import { collection, addDoc, serverTimestamp, Timestamp } from "firebase/firestore"; // Import Timestamp
import { db } from "./config";
import type { Budget } from "@/types";

// Type for the data to be added, excluding fields generated by Firestore
type AddBudgetData = Omit<Budget, 'id' | 'spentAmount' | 'deadline'> & {
  deadline: Date; // Expect Date object
};
/**
 * Adds a new budget document to the 'budgets' collection in Firestore.
 * @param budgetData The data for the new budget.
 * @returns A promise that resolves with the new document reference.
 */
export async function addBudget(budgetData: AddBudgetData) {
  try {
    const docRef = await addDoc(collection(db, "budgets"), {
      ...budgetData,
      deadline: Timestamp.fromDate(budgetData.deadline), // Convert Date to Timestamp
      spentAmount: 0, // Initialize spent amount to 0
      createdAt: serverTimestamp(),
    });
    return docRef;
  } catch (e) {
    console.error("Error adding document: ", e);
    throw new Error("Failed to add budget to Firestore.");
  }
}
